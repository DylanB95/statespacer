<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Specify it yourself! • statespacer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Specify it yourself!">
<meta property="og:description" content="A lot of models can be put in State Space form. Although the statespacer  package covers a lot of those models by providing the most common components you would expect to see in a State Space model, there may always be the need to implement something more sophisticated and novel. For this purpose, the statespacer package provides the option to specify a component yourself!
">
<meta property="og:image" content="https://dylanb95.github.io/statespacer/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@dylanbeijers">
<meta name="twitter:site" content="@dylanbeijers">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">statespacer</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/intro.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/dictionary.html">Dictionary</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/seatbelt.html">statespacer applied to UK Road Deaths</a>
    </li>
    <li>
      <a href="../articles/boxjenkins.html">Fitting ARIMA models with statespacer</a>
    </li>
    <li>
      <a href="../articles/selfspec.html">Specify it yourself!</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/DylanB95/statespacer/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="selfspec_files/header-attrs-2.3/header-attrs.js"></script><script src="selfspec_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Specify it yourself!</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DylanB95/statespacer/blob/master/vignettes/selfspec.Rmd"><code>vignettes/selfspec.Rmd</code></a></small>
      <div class="hidden name"><code>selfspec.Rmd</code></div>

    </div>

    
    
<p>A lot of models can be put in State Space form. Although the statespacer package covers a lot of those models by providing the most common components you would expect to see in a State Space model, there may always be the need to implement something more sophisticated and novel. For this purpose, the statespacer package provides the option to specify a component yourself!</p>
<p>In this vignette, you will learn how to specify a component yourself. We will implement the dynamic Nelson-Siegel model as specified by <span class="citation">Diebold, Rudebusch, and Aruoba (2006)</span>, using the dataset that is provided by the YieldCurve package, <span class="citation">Guirreri (2010)</span>.</p>
<div id="dynamic-nelson-siegel-model" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamic-nelson-siegel-model" class="anchor"></a>Dynamic Nelson-Siegel model</h2>
<p>The dynamic Nelson-Siegel model as specified by <span class="citation">Diebold, Rudebusch, and Aruoba (2006)</span> is as follows:</p>
<p><span class="math display">\[
\begin{aligned}
 y_t(\tau) ~ &amp;= ~ \beta_{1t} ~ + \beta_{2t} \left( \frac{1 ~ - ~ e^{-\lambda\tau}}{\lambda\tau}  \right) ~ + ~ \beta_{3t} \left( \frac{1 ~ - ~ e^{-\lambda\tau}}{\lambda\tau} ~ - ~ e^{-\lambda\tau}  \right) ~ + ~ \varepsilon_t(\tau), &amp;\varepsilon_t ~ &amp;\sim ~ N(0, ~ \sigma^2I_p), \\
 \beta_t ~ &amp;= ~ \left( I ~ - ~ \Phi\right)\mu ~ + ~ \Phi\beta_t + \eta_t, &amp;\eta_t ~ &amp;\sim ~ N(0, ~ \Sigma_{\eta}), \\ 
  &amp; &amp;\beta_1 ~ &amp;\sim ~ N(\mu, ~ P_{\beta}),
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(y_t(\tau)\)</span> is the interest rate at time <span class="math inline">\(t\)</span> for maturity <span class="math inline">\(\tau\)</span>, <span class="math inline">\(\lambda\)</span> is a constant, <span class="math inline">\(p\)</span> is the number of maturities (dependent variables), <span class="math inline">\(\beta_t\)</span> is the unobserved vector containing the factors <span class="math inline">\(\beta_{1t}\)</span>, <span class="math inline">\(\beta_{2t}\)</span>, <span class="math inline">\(\beta_{3t}\)</span>, <span class="math inline">\(\mu\)</span> is a vector containing the means of the factors, <span class="math inline">\(\Phi\)</span> is a vector autoregressive coefficient matrix corresponding to a stationary process, and <span class="math inline">\(P_\beta\)</span> is the initial uncertainty of <span class="math inline">\(\beta_1\)</span> that is chosen such that <span class="math inline">\(P_\beta ~ - ~ \Phi P_\beta \Phi^{\top} ~ = ~ \Sigma_\eta\)</span>. The factors in <span class="math inline">\(\beta\)</span> have an interesting interpretation: <span class="math inline">\(\beta_1\)</span> can be seen as the level for all interest rates, <span class="math inline">\(\beta_2\)</span> identifies the slope of the yield curve, and <span class="math inline">\(\beta_3\)</span> represents the shape of the yield curve.</p>
<p>Now that we have summarised the dynamic Nelson-Siegel model, we can go on and fit it using statespacer!</p>
</div>
<div id="fitting-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-model" class="anchor"></a>Fitting the model</h2>
<p>First, we load the data. We use the dataset that is provided by the YieldCurve package, see <span class="citation">Guirreri (2010)</span> for details. This dataset consists of the monthly US interest rates for 8 different maturities from January 1982 up to December 2012. The maturities are 3, 6, 12, 24, 36, 60, 84, and 120 months. For this exhibition, we make use of the period from January 1985 up to December 2000.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Load statespacer</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">statespacer</span>)

<span class="co"># Load the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">YieldCurve</span>)
<span class="co">#&gt; Loading required package: xts</span>
<span class="co">#&gt; Loading required package: zoo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'zoo'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     as.Date, as.Date.numeric</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"FedYieldCurve"</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html">window</a></span>(<span class="no">FedYieldCurve</span>, <span class="kw">start</span> <span class="kw">=</span> <span class="st">"1984-12-31"</span>, <span class="kw">end</span> <span class="kw">=</span> <span class="st">"2000-12-01"</span>)
<span class="no">years</span> <span class="kw">&lt;-</span> <span class="fu">index</span>(<span class="no">y</span>) <span class="co"># Used for plots later on</span>
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">y</span>)</pre></body></html></div>
<p>To fit the dynamic Nelson-Siegel model using statespacer, we need to pass on a list containing the specification of the model. See the Details section of <code><a href="../reference/statespacer.html">statespacer()</a></code> for extensive details about the format of this list!</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Specifying the list</span>
<span class="no">self_spec_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()

<span class="co"># We want to specify the H matrix ourselves</span>
<span class="no">self_spec_list</span>$<span class="no">H_spec</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># We have got 6 state parameters: 3 factors and 3 fixed means</span>
<span class="no">self_spec_list</span>$<span class="no">state_num</span> <span class="kw">&lt;-</span> <span class="fl">6</span>

<span class="co"># In total we need 20 parameters:</span>
<span class="co">#   1 for lambda</span>
<span class="co">#   1 for sigma2 (H)</span>
<span class="co">#   6 for the variance - covariance matrix Sigma_eta (Q)</span>
<span class="co">#   9 for the vector autoregressive coefficient matrix Phi</span>
<span class="co">#   3 for the means mu</span>
<span class="no">self_spec_list</span>$<span class="no">param_num</span> <span class="kw">&lt;-</span> <span class="fl">20</span>

<span class="co"># R is a fixed diagonal matrix</span>
<span class="no">self_spec_list</span>$<span class="no">R</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>)

<span class="co"># P_inf is a matrix of zeroes, as all state parameters are stationary</span>
<span class="no">self_spec_list</span>$<span class="no">P_inf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">6</span>)

<span class="co"># Needed because we want to use collapse = TRUE</span>
<span class="co"># The fixed means only appear in the state equations, </span>
<span class="co"># not in the observation equations. So the 4th, 5th, and 6th state parameters</span>
<span class="co"># are state_only.</span>
<span class="no">self_spec_list</span>$<span class="no">state_only</span> <span class="kw">&lt;-</span> <span class="fl">4</span>:<span class="fl">6</span></pre></body></html></div>
<p>We also specify <code>state_only</code> as we want to collapse the observation vector, which results in considerable computational savings. As our system matrices depend on the parameters, we specify <code>sys_mat_fun</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">self_spec_list</span>$<span class="no">sys_mat_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">param</span>) {

  <span class="co"># Maturities of the interest rates</span>
  <span class="no">maturity</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">24</span>, <span class="fl">36</span>, <span class="fl">60</span>, <span class="fl">84</span>, <span class="fl">120</span>)

  <span class="co"># The constant lambda</span>
  <span class="no">lambda</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">2</span> * <span class="no">param</span>[<span class="fl">1</span>])

  <span class="co"># The variance of the observation errors</span>
  <span class="no">sigma2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">2</span> * <span class="no">param</span>[<span class="fl">2</span>])
  <span class="no">H</span> <span class="kw">&lt;-</span> <span class="no">sigma2</span> * <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">8</span>)

  <span class="co"># Z matrix corresponding to the factors</span>
  <span class="no">lambda_maturity</span> <span class="kw">&lt;-</span> <span class="no">lambda</span> * <span class="no">maturity</span>
  <span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">lambda_maturity</span>)
  <span class="no">Z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">3</span>)
  <span class="no">Z</span>[, <span class="fl">2</span>] <span class="kw">&lt;-</span> (<span class="fl">1</span> - <span class="no">z</span>) / <span class="no">lambda_maturity</span>
  <span class="no">Z</span>[, <span class="fl">3</span>] <span class="kw">&lt;-</span> <span class="no">Z</span>[, <span class="fl">2</span>] - <span class="no">z</span>

  <span class="co"># Variance of the state disturbances</span>
  <span class="no">Q</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/Cholesky.html">Cholesky</a></span>(<span class="kw">param</span> <span class="kw">=</span> <span class="no">param</span>[<span class="fl">3</span>:<span class="fl">8</span>], <span class="kw">decompositions</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>))

  <span class="co"># Vector autoregressive coefficient matrix, enforcing stationarity</span>
  <span class="no">Tmat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CoeffARMA.html">CoeffARMA</a></span>(<span class="kw">A</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="no">param</span>[<span class="fl">9</span>:<span class="fl">17</span>], <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>)),
                 <span class="kw">variance</span> <span class="kw">=</span> <span class="no">Q</span>,
                 <span class="kw">ar</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">ma</span> <span class="kw">=</span> <span class="fl">0</span>)$<span class="no">ar</span>[,,<span class="fl">1</span>]

  <span class="co"># Initial uncertainty of the factors</span>
  <span class="no">T_kronecker</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html">kronecker</a></span>(<span class="no">Tmat</span>, <span class="no">Tmat</span>)
  <span class="no">Tinv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">T_kronecker</span>)[<span class="fl">1</span>], <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">T_kronecker</span>)[<span class="fl">2</span>]) - <span class="no">T_kronecker</span>)
  <span class="no">vecQ</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">Q</span>)
  <span class="no">vecPstar</span> <span class="kw">&lt;-</span> <span class="no">Tinv</span> <span class="kw">%*%</span> <span class="no">vecQ</span>
  <span class="no">P_star</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">vecPstar</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">Tmat</span>)[<span class="fl">1</span>], <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">Tmat</span>)[<span class="fl">2</span>])

  <span class="co"># Adding parts corresponding to the fixed means to the system matrices</span>
  <span class="no">Z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">Z</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">3</span>)) <span class="co"># Not used in the observation equation</span>
  <span class="no">Q</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/BlockMatrix.html">BlockMatrix</a></span>(<span class="no">Q</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span>)) <span class="co"># Fixed, so no variance in its errors</span>
  <span class="no">a1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">param</span>[<span class="fl">18</span>:<span class="fl">20</span>], <span class="fl">6</span>, <span class="fl">1</span>) <span class="co"># Fixed means go into the initial guess</span>
  <span class="no">Tmat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">Tmat</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>) - <span class="no">Tmat</span>)
  <span class="no">Tmat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">Tmat</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>)))
  <span class="no">P_star</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/BlockMatrix.html">BlockMatrix</a></span>(<span class="no">P_star</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span>))

  <span class="co"># Return the system matrices</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="no">H</span>, <span class="kw">Z</span> <span class="kw">=</span> <span class="no">Z</span>, <span class="kw">Tmat</span> <span class="kw">=</span> <span class="no">Tmat</span>, <span class="kw">Q</span> <span class="kw">=</span> <span class="no">Q</span>, <span class="kw">a1</span> <span class="kw">=</span> <span class="no">a1</span>, <span class="kw">P_star</span> <span class="kw">=</span> <span class="no">P_star</span>))
}</pre></body></html></div>
<p>If we want to obtain standard errors of certain (functions of) parameters, we specify <code>transform_fun</code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">self_spec_list</span>$<span class="no">transform_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">param</span>) {
  <span class="no">lambda</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">2</span> * <span class="no">param</span>[<span class="fl">1</span>])
  <span class="no">sigma2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">2</span> * <span class="no">param</span>[<span class="fl">2</span>])
  <span class="no">means</span> <span class="kw">&lt;-</span> <span class="no">param</span>[<span class="fl">18</span>:<span class="fl">20</span>]
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">lambda</span>, <span class="no">sigma2</span>, <span class="no">means</span>))
}</pre></body></html></div>
<p>Getting proper initial values can be a bit tricky, see <code><a href="../articles/dictionary.html">vignette("dictionary", "statespacer")</a></code> for details. Playing around with the parameters corresponding to <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\sigma^2\)</span>, the diagonal elements of <span class="math inline">\(\Sigma_\eta\)</span>, and the diagonal elements of <span class="math inline">\(\Phi\)</span> lead to the following initial values:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">initial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>, -<span class="fl">2</span>, -<span class="fl">1</span>, -<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>)</pre></body></html></div>
<p>However, for building this vignette, we make use of the already optimal parameters, to reduce the building time. But you can go ahead and use the initial values as specified above!</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Optimal parameters</span>
<span class="no">initial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1.27000018</span>, -<span class="fl">2.82637721</span>, -<span class="fl">1.35280609</span>, -<span class="fl">1.74569078</span>,
             -<span class="fl">0.89761151</span>, -<span class="fl">0.77767132</span>, <span class="fl">1.01894143</span>, <span class="fl">0.42965982</span>,
             <span class="fl">13.69072496</span>, <span class="fl">3.46050373</span>, -<span class="fl">10.36767668</span>, -<span class="fl">0.07334641</span>,
             <span class="fl">6.68658053</span>, <span class="fl">0.76975206</span>, <span class="fl">0.02852844</span>, <span class="fl">0.50448668</span>,
             <span class="fl">2.99984132</span>, <span class="fl">8.16851107</span>, -<span class="fl">2.28360681</span>, -<span class="fl">0.45333494</span>)</pre></body></html></div>
<p>Next, we fit the model! Notice that we use <code>collapse = TRUE</code>. This saves about <span class="math inline">\(60\%\)</span> of the computation time compared to <code>collapse = FALSE</code>, see for yourself!</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/statespacer.html">statespacer</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>,
                   <span class="kw">self_spec_list</span> <span class="kw">=</span> <span class="no">self_spec_list</span>,
                   <span class="kw">collapse</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                   <span class="kw">initial</span> <span class="kw">=</span> <span class="no">initial</span>,
                   <span class="kw">method</span> <span class="kw">=</span> <span class="st">"BFGS"</span>,
                   <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; Starting the optimisation procedure at: 2020-07-13 17:36:05</span>
<span class="co">#&gt; Parameter scaling: [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="co">#&gt; initial  value -7.005119 </span>
<span class="co">#&gt; final  value -7.005119 </span>
<span class="co">#&gt; converged</span>
<span class="co">#&gt; Finished the optimisation procedure at: 2020-07-13 17:36:06</span>
<span class="co">#&gt; Time difference of 0.213958978652954 secs</span></pre></body></html></div>
<p>Now, let us take a look at the smoothed factors:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># The level beta_1</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">years</span>, <span class="no">fit</span>$<span class="no">smoothed</span>$<span class="no">a</span>[, <span class="fl">1</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">'l'</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"year"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"level of yield curve"</span>)</pre></body></html></div>
<p><img src="selfspec_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
<span class="co"># The slope beta_2</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">years</span>, <span class="no">fit</span>$<span class="no">smoothed</span>$<span class="no">a</span>[, <span class="fl">2</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">'l'</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"year"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"slope of yield curve"</span>)</pre></body></html></div>
<p><img src="selfspec_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">
<span class="co"># The shape beta_3</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">years</span>, <span class="no">fit</span>$<span class="no">smoothed</span>$<span class="no">a</span>[, <span class="fl">3</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">'l'</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"year"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"shape of yield curve"</span>)</pre></body></html></div>
<p><img src="selfspec_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<p>And the fitted parameters:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">parameters</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lambda"</span>, <span class="st">"sigma2"</span>, <span class="st">"mu1"</span>, <span class="st">"mu2"</span>, <span class="st">"mu3"</span>),
  <span class="no">fit</span>$<span class="no">system_matrices</span>$<span class="no">self_spec</span>,
  <span class="no">fit</span>$<span class="no">standard_errors</span>$<span class="no">self_spec</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">parameters</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Parameter"</span>, <span class="st">"Value"</span>, <span class="st">"Standard Error"</span>)
<span class="no">parameters</span>
<span class="co">#&gt;      Parameter Value                 Standard Error        </span>
<span class="co">#&gt; [1,] "lambda"  "0.0788680312441378"  "0.00166081522213677" </span>
<span class="co">#&gt; [2,] "sigma2"  "0.00350791974797472" "0.000152454450860636"</span>
<span class="co">#&gt; [3,] "mu1"     "8.16851324553417"    "3.21497260089687"    </span>
<span class="co">#&gt; [4,] "mu2"     "-2.28360714382468"   "2.18547070109234"    </span>
<span class="co">#&gt; [5,] "mu3"     "-0.453332999643289"  "0.847782784608084"</span>

<span class="co"># Vector autoregressive coefficient matrix</span>
<span class="no">fit</span>$<span class="no">system_matrices</span>$<span class="no">T</span>$<span class="no">self_spec</span>[<span class="fl">1</span>:<span class="fl">3</span>, <span class="fl">1</span>:<span class="fl">3</span>]
<span class="co">#&gt;             [,1]        [,2]        [,3]</span>
<span class="co">#&gt; [1,]  0.98560526 -0.02011094 0.005610391</span>
<span class="co">#&gt; [2,] -0.02067396  0.94926564 0.062613884</span>
<span class="co">#&gt; [3,] -0.03372035 -0.04115172 0.964511165</span>

<span class="co"># Variance of the state disturbances</span>
<span class="no">fit</span>$<span class="no">system_matrices</span>$<span class="no">Q</span>$<span class="no">self_spec</span>[<span class="fl">1</span>:<span class="fl">3</span>, <span class="fl">1</span>:<span class="fl">3</span>]
<span class="co">#&gt;             [,1]        [,2]        [,3]</span>
<span class="co">#&gt; [1,]  0.06682889 -0.05197075  0.06809463</span>
<span class="co">#&gt; [2,] -0.05197075  0.07087475 -0.03986820</span>
<span class="co">#&gt; [3,]  0.06809463 -0.03986820  0.24109851</span></pre></body></html></div>
<p>As you can see, specifying components yourself is actually not as hard as it sounds! Doing this with statespacer allows you to make use of the various algorithms that are implemented in this package, such as dealing with missing observations, exact initialisation of diffuse state parameters, univariate treatment of multivariate models, and the collapsing of the observation vector!</p>
<p>If you want to learn more about the dynamic Nelson-Siegel model, take a look at <span class="citation">Diebold, Rudebusch, and Aruoba (2006)</span> and <span class="citation">Koopman, Mallee, and Van der Wel (2010)</span>. They propose various extensions of the model implemented in this vignette.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-diebold2006macroeconomy">
<p>Diebold, Francis X, Glenn D Rudebusch, and S Boragan Aruoba. 2006. “The Macroeconomy and the Yield Curve: A Dynamic Latent Factor Approach.” <em>Journal of Econometrics</em> 131 (1-2): 309–38.</p>
</div>
<div id="ref-YieldCurve">
<p>Guirreri, S. S. 2010. “Simulating the Term Structure of Interest Rates with Arbitrary Marginals.” PhD thesis, Palermo: University of Palermo - Department of Statistics; Mathematics ”S. Vianelli”.</p>
</div>
<div id="ref-koopman2010analyzing">
<p>Koopman, Siem Jan, Max IP Mallee, and Michel Van der Wel. 2010. “Analyzing the Term Structure of Interest Rates Using the Dynamic Nelson–Siegel Model with Time-Varying Parameters.” <em>Journal of Business &amp; Economic Statistics</em> 28 (3): 329–43.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.linkedin.com/in/dylanbeijers/">Dylan Beijers</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '7e05823736aed6581d25ab2a4c1524a0',
    indexName: 'statespacer',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
